@page "/voters/{VoterAddress}"

<Card Class="h-full flex flex-col md:flex-row items-start p-5 gap-3">
    <div class="w-full md:w-auto flex flex-col gap-3">
        <div class="flex flex-row w-full gap-3 text-nowrap">
            <div class="flex justify-center text-white flex-shrink-0 items-center w-14 h-14 rounded-md"
                 style="background-image: linear-gradient(@WebUtil.GetGradientDegrees(Model.ShortAddress)deg,#6b6dc8,#6b81c8,#9194d1);">
                <Heroicon Name="@HeroiconName.Wallet" class="block w-8 h-8"/>
            </div>

            <div class="flex flex-col items-start justify-center h-full text-lg max-w-sm">
                <span class="text-white">ამომრჩეველი</span>

                <div class="flex flex-col leading-4 font-mono text-start text-gray-400">
                    <span>@Model.Address[..22]-</span>
                    <span>@Model.Address[22..]</span>
                </div>
            </div>

        </div>

        <hr class="border-s border-gray-400 w-full"/>

        <section class="flex flex-col gap-2 text-start text-lg leading-5 text-gray-400 max-w-md">
            <span>
                ამ ამომრჩეველს ხმა მიცემული აქვს <b class="text-white">@Model.Votes.Count()</b> ჯერ.<br/>
            </span>

            @if (Model.FavoriteParty is { } favoriteParty)
            {
                <span>
                    მისი ფავორიტი პარტია არის <b class="@favoriteParty.GetTextClass()">@favoriteParty.Name.</b><br/>
                </span>
            }
            else
            {
                <span>
                    მას არ ჰყავს ფავორიტი პარტია.<br/>
                </span>
            }

            @if (Model.LastVoteTime is { } lastVoteTime)
            {
                <span class="[&>b]:text-white">
                    ბოლოს ხმა მიცემული აქვს:<br/>
                    <b>@lastVoteTime.ToString("d")</b>-ში
                    <b>@lastVoteTime.ToString("HH:mm:ss")</b>-ზე,<br/>
                    <TimeTracker For="@lastVoteTime" class="text-white"/>-ის წინ
                </span>
            }
        </section>

        <hr class="border-s border-gray-400 w-full"/>
    </div>


    <vr class="hidden md:block border-s border-gray-500 h-full"/>

    <div class="h-full overflow-y-scroll scrollbar-none">
        <h2 class="text-2xl text-white text-start" @onclick="@(() => VoteList.AddVote(VoteDto.RandomVoteDto()))">
            ხმები
        </h2>

        <VoteList @ref="VoteList" Votes="@Model.Votes.ToList()" Max="100"/>
    </div>
</Card>

@code
{
    [Parameter]
    public string VoterAddress { get; set; } = string.Empty;

    private VoteList VoteList { get; set; } = default!;

    private VoterDto Model { get; } = VoterDto.RandomVoterDto(Random.Shared.Next(0, 50));
}