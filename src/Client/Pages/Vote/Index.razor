@page "/vote"
@using Domain.ValueObjects

<PageTitle>Home</PageTitle>

<div class="h-full grid grid-cols-12 justify-center items-center gap-3 p-5">
    @foreach (var (partyId, party) in Parties)
    {
        <PartyCard @key="partyId" Party="@party" OnClick="@(() => VoteFor(party))"/>
    }

    <div class="block md:hidden col-span-12 p-3"></div>
</div>

@code
{
    [CascadingParameter]
    public IModalService Modal { get; set; } = default!;

    // TODO on initialized, if the cookies have last vote time in them, and it is not 12 hours behind,
    // then we should redirect the user to /stats

    private void VoteFor(Party party)
    {
        var parameters = new ModalParameters()
            .Add(nameof(VoteConfirmation.Party), party);

        Modal.Show<VoteConfirmation>(parameters);
    }

    private static readonly Dictionary<int, Party> Parties = Party.Allowed
        .Where(p => p != 0)
        .Select(p => (p, (Party)p))
        .ToDictionary();
}